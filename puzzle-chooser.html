<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Choose Puzzle</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin:0; padding:16px; background:#f7f9fb; color:#111 }
    h1 { font-size:18px; margin:0 0 12px }
    .list { display:flex; flex-direction:column; gap:8px }
    .item { background:#fff; border-radius:8px; padding:12px 14px; box-shadow:0 1px 3px rgba(0,0,0,0.06); cursor:pointer; display:flex; align-items:center; justify-content:space-between }
    .item:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,0.08) }
    .date { font-weight:600 }
    .choose { font-size:13px; color:#666 }
    .empty { text-align:center; color:#666; margin-top:30px }
    .close { position:fixed; right:12px; top:8px; border:none; background:#eee; padding:6px 8px; border-radius:6px; cursor:pointer }
  </style>
</head>
<body>
  <button class="close" onclick="window.close()">Close</button>
  <h1>Select a puzzle</h1>
  <div id="list" class="list">Loadingâ€¦</div>
  <div id="empty" class="empty" style="display:none">No puzzles found.</div>

  <script>
    // Generate descending date list from today back to 2025-08-27 (inclusive).
    function pad(n){return n<10? '0'+n : n}
    function fmt(d){return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate())}

    function choose(filename){
      try{
        if (window.opener && window.opener.loadDecryptedWebsite){
          window.opener.loadDecryptedWebsite("puzzles/" + filename);
        } else {
          console.warn('No opener to receive chosen filename');
        }
      }catch(e){ console.error(e) }
      window.close();
    }

    function loadList(){
      const container = document.getElementById('list');
      container.innerHTML = '';
      const today = new Date();
      const start = new Date(2025, 7, 27); // 2025-08-27 (month is 0-based)
      for(let d = new Date(today); d >= start; d.setDate(d.getDate() - 1)){
        const dateStr = fmt(d);
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<div><div class="date">${dateStr}</div><div class="choose">${dateStr}.json</div></div><div>Choose</div>`;
        div.onclick = () => choose(dateStr + '.json');
        container.appendChild(div);
      }
    }

    loadList();
  </script>
</body>
</html>
